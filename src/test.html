<!doctype html>
<html lang="en">
  <head>
    <title>Chart.js example</title>
  </head>
  <body>
    <!-- <div style="width: 500px;"><canvas id="dimensions"></canvas></div><br/> -->
    <!-- <div style="width:240px;height:240px"> -->

    <canvas id="myChart"></canvas>
    </div>
    <!-- <div style="width:240px;height:240px; margin-top:500px"> -->
    <canvas id="myChart2"></canvas>
    <canvas id="myChartBanned"></canvas>
    <canvas id="myChartAccuracy"></canvas>
    <!-- </div> -->
    <!-- <script type="module" src="dimensions.js"></script> -->
  </body>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="js/chart.js/dist/Chart.js"></script>
  <script>
  
$(function(){
  let cache = localStorage.getItem("cache");
  if (cache == null) {

    $.getJSON("http://localhost:8080/test",function( data ) {
      let trainingResults = data.trainingResults;
      console.log(trainingResults);
      localStorage.setItem("cache",JSON.stringify(trainingResults))
    createCharts(trainingResults);
    });
  } else {
    createCharts(JSON.parse(cache));
  } 
});
function createCharts(trainingResults){
  console.log(trainingResults);
  createChart(trainingResults);
  createChart2(trainingResults);
  createBannedChart(trainingResults);
  createAccuracyChart(trainingResults);

}
function createChart(trainingResults){
  let labels = [];
  let datasets = [];
  let colors = ['blue','red','green','yellow','purple','black','cyan','brown','gray'];
    let candidatesCount = trainingResults[0].candidatesCount;
    for (let i = 0; i < candidatesCount; i++) {
      let color = 'black';
      if (trainingResults[0].maliciousAccounts[i] & trainingResults[0].voterAccounts[i]) color = 'purple' 
      else if (trainingResults[0].maliciousAccounts[i]) color = 'red' 
      else if (trainingResults[0].voterAccounts[i]) color = 'blue' 
      datasets.push({
          label: (i+1).toString(),
          backgroundColor: color,
          data: []
        });
      
    }
  
    for (let i = 0; i < trainingResults.length; i++) {
      labels.push("Iteration "+(i+1))
      for (let j = 0; j < candidatesCount; j++) {
        datasets[j].data.push(trainingResults[i].reputations[j]);
      }
    }
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
          datasets:datasets
        },
        options: {
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero: true
                  }
              }]
          },
          legendCallback: function(chart) {
            console.log(chart);
              // Return the HTML string here.
          }
        }
        
    });
}
  
function createChart2(trainingResults){
  let labels = [];
  let datasets = [];
  let colors = ['blue','red','green','yellow','purple','black','cyan','brown','gray'];
  let candidatesCount = trainingResults[0].candidatesCount;
  for (let i = 0; i < candidatesCount; i++) {
    let color = 'black';
    if (trainingResults[0].maliciousAccounts[i] & trainingResults[0].voterAccounts[i]) color = 'purple' 
    else if (trainingResults[0].maliciousAccounts[i]) color = 'red' 
    else if (trainingResults[0].voterAccounts[i]) color = 'blue' 
    datasets.push({
        label: (i+1).toString(),
        backgroundColor: color,
        data: []
      });
    
  }

  for (let i = 0; i < trainingResults.length; i++) {
    labels.push("Iteration "+(i+1))
    for (let j = 0; j < candidatesCount; j++) {
      datasets[j].data.push(trainingResults[i].candidates[j].accuracy);
    }
  }
  var ctx = document.getElementById('myChart2').getContext('2d');
  var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
          labels: labels,
        datasets:datasets
      },
      options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        },
        legendCallback: function(chart) {
            // Return the HTML string here.
        }
      }
      
  });
}
  
  
function createBannedChart(trainingResults){
  let labels = [];
  let datasets = [];
    let candidatesCount = trainingResults[0].candidatesCount;
    for (let i = 0; i < candidatesCount; i++) {
      let color = 'black';
      if (trainingResults[0].maliciousAccounts[i] & trainingResults[0].voterAccounts[i]) color = 'purple' 
      else if (trainingResults[0].maliciousAccounts[i]) color = 'red' 
      else if (trainingResults[0].voterAccounts[i]) color = 'blue' 
      datasets.push({
          label: (i+1).toString(),
          backgroundColor: color,
          data: []
        });
      
    }
  
    for (let i = 0; i < trainingResults.length; i++) {
      labels.push("Iteration "+(i+1))
      for (let j = 0; j < candidatesCount; j++) {
        if(trainingResults[i].bannedAccounts[j])
        datasets[j].data.push(1);
        else
        datasets[j].data.push(0);
      }
    }
    var ctx = document.getElementById('myChartBanned').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
          datasets:datasets
        },
        options: {
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero: true
                  }
              }]
          },
          legendCallback: function(chart) {
              // Return the HTML string here.
          }
        }
        
    });
}
  
function createAccuracyChart(trainingResults){
  let labels = [];
  let datasets = [];
  let accuracyList = [];
  
  for (let i = 0; i < trainingResults.length; i++) {
    labels.push("Iteration "+(i+1))
    accuracyList.push(trainingResults[i].globalAccuracy/100)
  }
  datasets.push({
    label: "Global Accuracy",
    backgroundColor: 'black',
    data: accuracyList,
    fill:false
  });
  var ctx = document.getElementById('myChartAccuracy').getContext('2d');
  var myChart = new Chart(ctx, {
      type: 'line',
      
      data: {
        labels: labels,
        datasets: datasets
      },
      options: {}
      
  });
}

  </script>
</html>
 